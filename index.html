<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Code Editor with Layer Move & Version 3</title>
<style>
body { margin: 0; font-family: monospace; display: flex; flex-direction: column; height: 100vh; }

/* Editor layout */
.editor { display: flex; background: #1e1e1e; color: #ddd; overflow: hidden; height: 30%; }
.lines { background: #2b2b2b; padding: 5px; text-align: right; color: #777; user-select: none; }
textarea { flex: 1; background: transparent; border: none; color: inherit; padding: 5px; outline: none; font-size: 14px; line-height: 1.5; }

/* Buttons */
button { padding: 6px 12px; margin: 5px; cursor: pointer; border: none; color: white; }
.run-btn { background: #4caf50; }
.clear-btn { background: #f44336; }
#layerBtn, #moveBtn { background: #2196F3; }

/* Preview iframe */
iframe { width: 100%; height: 40%; border: 1px solid #000; margin-top: 10px; }

/* Layer panel */
#layerPanel { background: #222; color: #ddd; padding: 10px; display: none; flex-direction: column; gap: 10px; position: relative; }
.layerItem { border: 1px solid #555; width: 100px; height: 100px; display: flex; align-items: center; justify-content: center; overflow: hidden; position: relative; cursor: pointer; }
.layerItem.selected { outline: 2px solid yellow; }

/* Controls section under layers */
#layerControlsPanel { display: none; flex-direction: column; gap: 5px; padding: 5px; background: #333; }
input[type=range] { width: 100%; }

/* Highlight for selected element in preview */
.highlight { outline: 2px solid red; }

/* Version number at bottom */
.bottom-number { margin-top: auto; text-align: center; padding: 10px; background: #222; color: #fff; font-size: 24px; }
</style>
</head>
<body>

<!-- Buttons -->
<button class="run-btn" onclick="runCode()">Run</button>
<button class="clear-btn" onclick="clearCode()">Clear</button>
<button id="layerBtn">Layer Selection</button>

<!-- Editor -->
<div class="editor">
  <div class="lines" id="lineNumbers">1</div>
  <textarea id="code" oninput="updateLines()" spellcheck="false">// Type HTML, SVG, CSS, JS here
<div style="width:100px;height:100px;background:orange;margin:20px;">Box</div>
<p style="color:blue;font-size:20px;">Hello World</p>
<svg width="100" height="100"><circle cx="50" cy="50" r="40" fill="green"/></svg>
<img src="https://via.placeholder.com/50" />
  </textarea>
</div>

<!-- Preview -->
<iframe id="preview"></iframe>

<!-- Layer panel -->
<div id="layerPanel"></div>

<!-- Move controls -->
<div id="layerControlsPanel">
  <button id="moveBtn">Move</button>
  <div id="moveSliders" style="display:none;">
    <label>X: <input type="range" id="sliderX" min="0" max="300" value="0"></label>
    <label>Y: <input type="range" id="sliderY" min="0" max="300" value="0"></label>
  </div>
</div>

<!-- Version number -->
<div class="bottom-number">3</div>

<script>
const codeArea = document.getElementById("code");
const lineNumbers = document.getElementById("lineNumbers");
const preview = document.getElementById("preview");
const layerBtn = document.getElementById('layerBtn');
const layerPanel = document.getElementById('layerPanel');
const layerControlsPanel = document.getElementById('layerControlsPanel');
const moveBtn = document.getElementById('moveBtn');
const moveSliders = document.getElementById('moveSliders');
const sliderX = document.getElementById('sliderX');
const sliderY = document.getElementById('sliderY');

let layerMode = false;
let selectedLayer = null;

// Update line numbers
function updateLines() {
  const code = codeArea.value;
  const lineCount = code.split("\n").length;
  lineNumbers.innerText = Array.from({length: lineCount}, (_, i) => i + 1).join("\n");
}
updateLines();

// Run code: display in iframe
function runCode() {
  preview.srcdoc = codeArea.value;
  layerPanel.style.display = 'none';
  layerControlsPanel.style.display = 'flex';
  moveSliders.style.display = 'none';
}

// Clear editor and preview
function clearCode() {
  codeArea.value = '';
  updateLines();
  preview.srcdoc = '';
  layerPanel.style.display = 'none';
  moveSliders.style.display = 'none';
  selectedLayer = null;
}

// Toggle layer selection
layerBtn.addEventListener('click', () => {
  layerMode = !layerMode;
  layerPanel.style.display = layerMode ? 'flex' : 'none';
  layerBtn.textContent = layerMode ? 'Exit Layer Selection' : 'Layer Selection';
  
  if (!layerMode) {
    const doc = preview.contentDocument || preview.contentWindow.document;
    doc.querySelectorAll('*').forEach(el => el.classList.remove('highlight'));
  }
});

// Layer selection inside iframe
preview.addEventListener('load', () => {
  const doc = preview.contentDocument || preview.contentWindow.document;
  
  doc.body.addEventListener('click', e => {
    if (!layerMode) return;
    e.preventDefault();
    e.stopPropagation();
    
    const target = e.target;
    if (target === doc.body) return;

    target.classList.add('highlight');

    // Add layer item
    const layerItem = document.createElement('div');
    layerItem.className = 'layerItem';
    
    const wrapper = document.createElement('div');
    wrapper.style.transform = 'scale(0.6)';
    wrapper.style.transformOrigin = 'top left';
    wrapper.style.width = target.offsetWidth + 'px';
    wrapper.style.height = target.offsetHeight + 'px';
    wrapper.innerHTML = target.outerHTML;
    
    layerItem.appendChild(wrapper);

    // Click to select layer
    layerItem.addEventListener('click', () => {
      if (selectedLayer) selectedLayer.classList.remove('selected');
      selectedLayer = layerItem;
      layerItem.classList.add('selected');
      moveSliders.style.display = 'none'; // hide sliders until move is clicked
      sliderX.value = 0; sliderY.value = 0; // reset sliders
    });

    layerPanel.appendChild(layerItem);
  }, true);
});

// Move button
moveBtn.addEventListener('click', () => {
  if (!selectedLayer) return;
  moveSliders.style.display = moveSliders.style.display === 'none' ? 'block' : 'none';
});

// Sliders control selected layer
sliderX.addEventListener('input', () => {
  if (!selectedLayer) return;
  selectedLayer.querySelector('div').style.left = sliderX.value + 'px';
  selectedLayer.querySelector('div').style.position = 'absolute';
});
sliderY.addEventListener('input', () => {
  if (!selectedLayer) return;
  selectedLayer.querySelector('div').style.top = sliderY.value + 'px';
  selectedLayer.querySelector('div').style.position = 'absolute';
});
</script>

</body>
</html>
