<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Single Light on Multiple Shapes</title>
<style>
  body {
    margin: 0;
    font-family: monospace;
    background: #000;
    color: #fff;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
  }

  .controls {
    display: flex;
    gap: 5px;
    margin-bottom: 10px;
  }

  button {
    padding: 8px 14px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    color: #fff;
  }

  .green-btn { background: #4caf50; }
  .red-btn { background: #f44336; }
  .light-btn { background: #ffeb3b; color: #000; }
  .move-btn { background: #2196F3; }

  #preview {
    width: 400px;
    height: 400px;
    background: #000;
    position: relative;
    border: 1px solid #555;
  }

  .shape, .shape2 {
    position: absolute;
    overflow: hidden;
  }

  .shape {
    width: 150px;
    height: 150px;
    background: green;
    top: 125px;
    left: 125px;
  }

  .shape2 {
    width: 100px;
    height: 100px;
    background: red;
    border-radius: 50%;
    top: 50px;
    left: 50px;
  }

  .light {
    position: absolute;
    width: 400px;
    height: 400px;
    top: 0;
    left: 0;
    background: radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(255,255,255,0.6) 40%, rgba(255,255,0,0.2) 70%, rgba(255,255,0,0) 100%);
    filter: blur(15px);
    pointer-events: none;
    mask-image: none; /* will be set dynamically */
    -webkit-mask-image: none;
  }

  .arrows { display: none; gap: 5px; margin-top: 5px; }
  .arrow-btn { width: 40px; height: 40px; font-size: 20px; background: #333; color: #fff; }
</style>
</head>
<body>

<div class="controls">
  <button class="green-btn">Green Square</button>
  <button class="red-btn">Red Circle</button>
  <button class="light-btn">Light</button>
  <button class="move-btn">Move</button>
</div>

<div class="arrows">
  <button class="arrow-btn" data-dx="0" data-dy="-10">↑</button>
  <button class="arrow-btn" data-dx="0" data-dy="10">↓</button>
  <button class="arrow-btn" data-dx="-10" data-dy="0">←</button>
  <button class="arrow-btn" data-dx="10" data-dy="0">→</button>
</div>

<div id="preview"></div>

<script>
const preview = document.getElementById('preview');
const greenBtn = document.querySelector('.green-btn');
const redBtn = document.querySelector('.red-btn');
const lightBtn = document.querySelector('.light-btn');
const moveBtn = document.querySelector('.move-btn');
const arrows = document.querySelector('.arrows');

let lightDiv = null;
let lightPos = {x: 0, y: 0};

// Add shapes
greenBtn.addEventListener('click', () => {
    const div = document.createElement('div');
    div.className = 'shape';
    preview.appendChild(div);
    updateMask();
});
redBtn.addEventListener('click', () => {
    const div = document.createElement('div');
    div.className = 'shape2';
    preview.appendChild(div);
    updateMask();
});

// Add single light
lightBtn.addEventListener('click', () => {
    if (!lightDiv) {
        lightDiv = document.createElement('div');
        lightDiv.className = 'light';
        lightDiv.style.transform = `translate(${lightPos.x}px, ${lightPos.y}px)`;
        preview.appendChild(lightDiv);
        updateMask();
    }
});

// Move button toggles arrows
moveBtn.addEventListener('click', () => {
    arrows.style.display = arrows.style.display === 'flex' ? 'none' : 'flex';
});

// Move light with arrows
arrows.querySelectorAll('.arrow-btn').forEach(btn => {
    btn.addEventListener('click', () => {
        const dx = parseInt(btn.dataset.dx);
        const dy = parseInt(btn.dataset.dy);
        lightPos.x += dx;
        lightPos.y += dy;
        if(lightDiv) lightDiv.style.transform = `translate(${lightPos.x}px, ${lightPos.y}px)`;
    });
});

// Update mask so light only shows on shapes
function updateMask() {
    if (!lightDiv) return;
    const shapes = preview.querySelectorAll('.shape, .shape2');
    let maskSVG = `<svg xmlns="http://www.w3.org/2000/svg" width="400" height="400"><mask id="m">`;
    shapes.forEach((s,i) => {
        const rect = s.getBoundingClientRect();
        const previewRect = preview.getBoundingClientRect();
        const top = rect.top - previewRect.top;
        const left = rect.left - previewRect.left;
        const width = rect.width;
        const height = rect.height;
        const rx = s.classList.contains('shape2') ? width/2 : 0;
        maskSVG += `<rect x="${left}" y="${top}" width="${width}" height="${height}" rx="${rx}" fill="white"/>`;
    });
    maskSVG += `</mask><rect width="100%" height="100%" fill="white" mask="url(#m)"/></svg>`;
    lightDiv.style.maskImage = `url('data:image/svg+xml;utf8,${encodeURIComponent(maskSVG)}')`;
    lightDiv.style.webkitMaskImage = `url('data:image/svg+xml;utf8,${encodeURIComponent(maskSVG)}')`;
}
</script>

</body>
</html>
