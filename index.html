<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Master Light Mask Example</title>
<style>
  body {
    background: black;
    color: white;
    font-family: sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    margin: 0;
    height: 100vh;
  }
  svg {
    border: 1px solid #555;
    background: black;
  }
  .controls { margin-top: 10px; }
  button {
    margin: 2px;
    padding: 5px 10px;
    cursor: pointer;
  }
</style>
</head>
<body>

<svg id="canvas" width="400" height="400">
  <defs>
    <radialGradient id="lightGradient" cx="50%" cy="50%" r="50%">
      <stop offset="0%" stop-color="white" stop-opacity="1" />
      <stop offset="100%" stop-color="black" stop-opacity="0" />
    </radialGradient>
  </defs>

  <!-- Shape 1 -->
  <rect id="shape1" x="50" y="50" width="100" height="100" fill="green"/>
  <!-- Shape 2 -->
  <rect id="shape2" x="250" y="50" width="100" height="100" fill="red"/>
</svg>

<div class="controls">
  <button id="addLightBtn">Add Light</button>
  <button onclick="moveLight(0,-10)">Up</button>
  <button onclick="moveLight(0,10)">Down</button>
  <button onclick="moveLight(-10,0)">Left</button>
  <button onclick="moveLight(10,0)">Right</button>
  <button id="maskBtn">Mask Light</button>
</div>

<script>
const svg = document.getElementById("canvas");
const shapes = [document.getElementById("shape1"), document.getElementById("shape2")];
let masterLight = null;
let cx = 100, cy = 100;

// Add master light
document.getElementById("addLightBtn").addEventListener("click", () => {
  if(masterLight) return;
  masterLight = document.createElementNS("http://www.w3.org/2000/svg","circle");
  masterLight.setAttribute("cx", cx);
  masterLight.setAttribute("cy", cy);
  masterLight.setAttribute("r", 50);
  masterLight.setAttribute("fill", "url(#lightGradient)");
  svg.appendChild(masterLight);
});

// Move master light
function moveLight(dx, dy) {
  if(!masterLight) return;
  cx += dx;
  cy += dy;
  masterLight.setAttribute("cx", cx);
  masterLight.setAttribute("cy", cy);
}

// Mask: generate a separate light for each shape
document.getElementById("maskBtn").addEventListener("click", () => {
  if(!masterLight) return;
  shapes.forEach(shape => {
    const mask = document.createElementNS("http://www.w3.org/2000/svg","mask");
    const maskId = "mask_" + shape.id;
    mask.setAttribute("id", maskId);
    
    const whiteRect = document.createElementNS("http://www.w3.org/2000/svg","rect");
    whiteRect.setAttribute("x","0");
    whiteRect.setAttribute("y","0");
    whiteRect.setAttribute("width","400");
    whiteRect.setAttribute("height","400");
    whiteRect.setAttribute("fill","black");
    
    const lightCircle = document.createElementNS("http://www.w3.org/2000/svg","circle");
    lightCircle.setAttribute("cx", cx);
    lightCircle.setAttribute("cy", cy);
    lightCircle.setAttribute("r", 50);
    lightCircle.setAttribute("fill","white");
    
    mask.appendChild(whiteRect);
    mask.appendChild(lightCircle);
    svg.querySelector("defs").appendChild(mask);
    
    const lightOverlay = document.createElementNS("http://www.w3.org/2000/svg","rect");
    lightOverlay.setAttribute("x", shape.getAttribute("x"));
    lightOverlay.setAttribute("y", shape.getAttribute("y"));
    lightOverlay.setAttribute("width", shape.getAttribute("width"));
    lightOverlay.setAttribute("height", shape.getAttribute("height"));
    lightOverlay.setAttribute("fill", "url(#lightGradient)");
    lightOverlay.setAttribute("mask", `url(#${maskId})`);
    svg.appendChild(lightOverlay);
  });

  // Remove master light after masking
  masterLight.remove();
  masterLight = null;
});
</script>

</body>
</html>
