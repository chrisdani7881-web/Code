<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Light Mask Demo</title>
<style>
body {
  margin: 0;
  background: #000;
  font-family: monospace;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100vh;
}

.controls {
  display: flex;
  gap: 5px;
  margin-bottom: 10px;
  flex-wrap: wrap;
}

button {
  padding: 8px 14px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
  color: #fff;
}

.run-btn { background: #4caf50; }
shape1-btn { background: #2196F3; }
.shape2-btn { background: #f44336; }
.light-btn { background: #ffeb3b; color: #000; }
.move-btn { background: #9c27b0; }
.mask-btn { background: #9e9e9e; color: black; }
.arrow-btn { width: 40px; height: 40px; font-size: 20px; background: #333; }

#preview {
  width: 400px;
  height: 400px;
  position: relative;
  border: 1px solid #555;
  overflow: hidden;
  background: #000;
}

.shape {
  width: 150px;
  height: 150px;
  background: green;
  position: absolute;
  top: 125px;
  left: 125px;
  overflow: hidden;
}

.shape2 {
  width: 100px;
  height: 100px;
  background: red;
  border-radius: 50%;
  position: absolute;
  top: 50px;
  left: 50px;
  overflow: hidden;
}

.light {
  width: 200px;
  height: 200px;
  border-radius: 50%;
  position: absolute;
  top: 0;
  left: 0;
  background: radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(255,255,255,0.6) 40%, rgba(255,255,0,0.2) 70%, rgba(255,255,0,0) 100%);
  filter: blur(15px);
  pointer-events: none;
}

.arrows {
  display: none;
  gap: 5px;
  margin-top: 5px;
}
</style>
</head>
<body>

<div class="controls">
  <button class="shape1-btn">Add Green Square</button>
  <button class="shape2-btn">Add Red Circle</button>
  <button class="light-btn">Add Light</button>
  <button class="move-btn">Move Light</button>
  <button class="mask-btn">Mask Selected Shape</button>
</div>

<div class="arrows">
  <button class="arrow-btn" data-dx="0" data-dy="-10">↑</button>
  <button class="arrow-btn" data-dx="0" data-dy="10">↓</button>
  <button class="arrow-btn" data-dx="-10" data-dy="0">←</button>
  <button class="arrow-btn" data-dx="10" data-dy="0">→</button>
</div>

<div id="preview"></div>

<script>
const preview = document.getElementById('preview');
const greenBtn = document.querySelector('.shape1-btn');
const redBtn = document.querySelector('.shape2-btn');
const lightBtn = document.querySelector('.light-btn');
const moveBtn = document.querySelector('.move-btn');
const maskBtn = document.querySelector('.mask-btn');
const arrows = document.querySelector('.arrows');

let layers = [];
let lastShape = null;
let lightDiv = null;
let selectedShape = null;

// Add shapes
greenBtn.addEventListener('click', () => {
  const shape = document.createElement('div');
  shape.className = 'shape';
  preview.appendChild(shape);
  layers.push(shape);
  lastShape = shape;
  selectedShape = shape;
});

redBtn.addEventListener('click', () => {
  const shape = document.createElement('div');
  shape.className = 'shape2';
  preview.appendChild(shape);
  layers.push(shape);
  lastShape = shape;
  selectedShape = shape;
});

// Add global light
lightBtn.addEventListener('click', () => {
  if(lightDiv) return;
  lightDiv = document.createElement('div');
  lightDiv.className = 'light';
  lightDiv.style.top = '0px';
  lightDiv.style.left = '0px';
  preview.appendChild(lightDiv);
});

// Toggle move arrows
moveBtn.addEventListener('click', () => {
  arrows.style.display = arrows.style.display === 'flex' ? 'none' : 'flex';
});

// Move light
arrows.querySelectorAll('.arrow-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    if(!lightDiv) return;
    let top = parseInt(lightDiv.style.top || 0);
    let left = parseInt(lightDiv.style.left || 0);
    const dx = parseInt(btn.dataset.dx);
    const dy = parseInt(btn.dataset.dy);
    lightDiv.style.top = (top + dy) + 'px';
    lightDiv.style.left = (left + dx) + 'px';
  });
});

// Mask light to selected shape
maskBtn.addEventListener('click', () => {
  if(!selectedShape || !lightDiv) return;
  // Clone the light and mask it to the selected shape
  const maskLight = lightDiv.cloneNode(true);
  maskLight.style.top = (parseInt(maskLight.style.top) - selectedShape.offsetTop) + 'px';
  maskLight.style.left = (parseInt(maskLight.style.left) - selectedShape.offsetLeft) + 'px';
  maskLight.style.position = 'absolute';
  selectedShape.appendChild(maskLight);
});
</script>

</body>
</html>
